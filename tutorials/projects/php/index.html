<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="php php-examples php-database-connection">
    <meta name="author" content="Ajantha Bandara elvinlabs.com">

    <title>AjanthaB</title>

    <!-- Bootstrap Core CSS -->
    <link href="../../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../../css/clean-blog.min.css" rel="stylesheet">
    <link href="../../css/clean-blog.css" rel="stylesheet">
    <link href="../../css/themes/monokai.css" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

 

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../../index.html">AjanthaB</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="index.html">Home</a>
                    </li>
                    <li>
                        <a href="http://ajantha.elvinlabs.com/">About</a>
                    </li>
                   <!--  <li>
                        <a href="post.html">Sample Post</a>
                    </li> -->
                    <li>
                        <a href="http://ajantha.elvinlabs.com/">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header class="intro-header" style="background-image: url('img/php.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1 style="color:#8A2BE2;margin-top:-140px;">PHP Frequently used things </h1>
                        
                        <span class="meta">Posted by <a href="#">AjanthaB</a> on Oct 23, 2015</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <article>
        <div class="container">
            <div class="row">

                <div class="col-lg-3 col-md-3">
                    <ul class="left-nav">

                        <h3>Other Topics</h3>
                        <li>
                            <a href="../MongoDB/">MongoDB</a>
                        </li>
                        <li>
                            <a href="index.html">PHP</a>
                        </li>

                    </ul>  
                </div>


                <div class="col-lg-9  col-md-8 ">
                    

                   <p>PHP(...) </p>
                   </p>
                    <p class="" style="margin-top:0px;">In this tutorial you can see the most important things you want, when developing php based project.</a> </p>

                    <h3 class="text-info">Connect to MYSQL Database using php</h3>

                    
	            
                    
                    <p>in php we normaly define the database names and passwords, because they not going to change</p>
                    <p>'define.php' file</p>
                    <pre>
                    	<code data-language="php">
&lt?php
	define("HOST","localhost");
	define("DBNAME","databaseName");
	define("UNAME","username");
	define("PW","password");
?&gt
                    		
                    	</code>
                    </pre>                        
                    <p>varible name you can change to what ever you want. When you get this varibles to any other php file you have to <b>require<b> this file (<b class="text-warning">keep in mind don't use include because incluse does not give any error or warning if file is not availabe, but require is give error message if file is not availabe</b>). </p>
                    
                    <p>you can require any file like this</p>
                    <pre>
                    	<code data-language="php">
&lt?php
	require 'define.php';
?&gt
                    	</code>
                    </pre> 

                    <p>Now you can create a connection to to database using bellow example. If thre is a error when conneting to database function will show you relevent error message, if not new connection will return

                    </p>
                    <p><b>function.php file</b></p>
                    <pre>
                    	<code data-language="php">
&lt?php
	require 'define.php';

	function getconnection(){
		$connection = mysqli_connect(HOST,UNAME,PW,DBNAME);
		if(mysqli_connect_error() ){
			echo('Failed to connect MYSQL DB  '.mysqli_connect_error() );
		} else return $connection;
	}
	// to get new connection
	$con = getconnection();

?&gt                    		
                    	</code>
                    </pre>   
      				

      				<h3 class="text-info">Execute simple MYSQL Query</h3>
      				<p>First we want database connection to execute the query.Next we can execute the query using this example</p>

      				<pre>
      					<code data-language="php">
&lt?php
	require 'function.php';
	$connection = getconnection();

	$query ="your query";
	// example => $query = "insert into people(name,ssn,address) values('name','12345','Anuradhapura,galnewa')";
	if($connection->query($query)){
        	echo "query executed";
    	}else echo $connection->error;	

?&gt
      					</code>
      				</pre>


      				<p>or you can define a simple function for that also.</p>
      				<pre>
      					<code data-language="php">
&lt?php
	function query_execute( $connection, $query){
		$result = $connection-&gtquery($query);
		if($result) return $result;
		else echo $connection-&gterror;
	}
?&gt
      					</code>
      				</pre>

                  <h3 class="text-info">Image Upload using php</h3>
                  <h4 class="text-info">Upload single image</h4>
                  <p>To upload a single immage to given directory you can use this example</p>
                  <p>HTML code for upload single image</p>
                  <pre>
                  	<code data-language="html">
    &ltform methode="post" action="index.php" enctype="multipart/form-data"&gt
    		&ltinput type="file" name="files"&gt
    		&lt input type="submit" value="upload" &gt
     &lt/form&gt
                  	</code>
                  </pre>

                  <p>PHP code for that</p>
                  <pre>
                  	<code  data-language="php">
function image_save($target_dir,$files){
    $target_file = $target_dir . basename($_FILES["files"]["name"]);
    $uploadOk = 1;
    $imageFileType = pathinfo($target_file,PATHINFO_EXTENSION);
    // Check if image file is a actual image or fake image
    
        $check = getimagesize($_FILES["files"]["tmp_name"]);
        if($check !== false) {
            //echo "File is an image - " . $check["mime"] . ".";
            $uploadOk = 1;
        } else {
            echo "File is not an image.";
            $uploadOk = 0;
        }
    
    // Check if file already exists
    if (file_exists($target_file)) {
        echo "Sorry, file already exists.";
        $uploadOk = 0;
    }
    // Check file size
    if ($_FILES["files"]["size"] > 5145728) {
        echo "Sorry, your file is too large.";
        $uploadOk = 0;
    }
    // Allow certain file formats
    if($imageFileType != "jpg" && $imageFileType != "png" && $imageFileType != "jpeg"
    && $imageFileType != "gif" ) {
        echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.";
        $uploadOk = 0;
    }
    // Check if $uploadOk is set to 0 by an error
    if ($uploadOk == 0) {
        echo "Sorry, your file was not uploaded.";
    // if everything is ok, try to upload file
    } else {
        if (move_uploaded_file($_FILES["files"]["tmp_name"], $target_file)) {
            echo "The file ". basename( $_FILES["files"]["name"]). " has been uploaded.";
        } else {
            echo "Sorry, there was an error uploading your file.";
        }
    }
    if($uploadOk != 0) return $_FILES["files"]["name"];
    else return "";
    
    
}
                  	</code>	
                  </pre>

                  <h4 class="text-info">Upload multiple images</h4>
                  <p>for that you have to use array to pass all details about images</p>
                  <pre>
                  	<code data-language="html">
    &ltform methode="post" action="index.php" enctype="multipart/form-data"&gt
    		&ltinput type="file" name="files[]"&gt
    		&lt input type="submit" value="upload" &gt
     &lt/form&gt
                  	</code>
                  </pre>

                  <p>In this function not going to check image type anymore. If images sucessfuly stored in directory function will return path for images, otherwise will send error message</p>
                  <pre>
                  	<code data-language="php">
 // in here we give three inputs
 // filles array, desired directory for store the images and derectory name for store the images
 // ex= > save_img( $files,  '/img/','image1');

function save_img( $files,  $desired_dir,$dir_name){
        $errors = array();
        $images ="";
        $count = 0;
        
        foreach($_FILES['files']['tmp_name'] as $key => $tmp_name ){
            $file = explode(".",$key.$_FILES['files']['name'][$key]);
            $file_name =$dir_name."-".$count.".".end($file);
            //print($file_name);
            $count++;
            $file_size =$_FILES['files']['size'][$key];
            $file_tmp =$_FILES['files']['tmp_name'][$key];
            $file_type=$_FILES['files']['type'][$key];
                                        
            $img_path = $desired_dir.'/'.$file_name;                                   
            $images = $images.",".$img_path;
            
            if($file_size > 5145728){
                $errors[]='File size must be less than 5 MB';
            }
          
            
            if(empty($errors)==true){
                if(is_dir($desired_dir)==false){
                    mkdir("$desired_dir", 0754);		// Create directory if it does not exist
                }
                if(is_dir("$desired_dir/".$file_name)==false){
                    move_uploaded_file($file_tmp,"$desired_dir/".$file_name);
                }else{									// rename the file if another one exist
                    $new_dir="$desired_dir/".$file_name.time();
                    rename($file_tmp,$new_dir) ;				
                }
                	
                
            }else{
                print_r($errors);
            }
            
            return $img_path;
        }
                                
        if(empty($error)){
            echo "Success";
            return true;
        }else return false;            
  
    }  
                  	</code>
                  </pre>



               <h4 class="text-info">Simple Login logout script</h4>
               
               <p>login.php file is used to keep session for users. for session key we have to use unique value for each user. As example lets think we have user_id for each user.using that we can keep session for each user.we take details as username and password. in database password is stored as md5 coverted password in this example. it can be change acording to your project</p>

               <pre>
               	<code data-language="html">
 &ltform  action="index.php" method="post"&gt
      &ltinput  placeholder="uname" name="uname" type="text" autofocus&gt              
      &ltinput  placeholder="Password" name="password" type="password" value=""&gt
      &ltinput class="form-control" name="login" type="submit" value="Login"&gt
 &lt/form&gt  
               	</code>
               </pre>   

               <p>PHP script for check user_id. If thre is a session for user_id then redirect to relevent directory. if not redirecto to login page again.</p>

               <pre>
               		<code data-language="php">
&lt?php
    session_start();
    if(isset($_SESSION['user_id'])!="")
    {
        header("Location:../home/");
    }                   
?&gt
               		</code>
               </pre>


               <p>If post came</p>
               <pre>
               		<code data-language="php">
&lt?php
  if($_POST){  
        require "define.php";
        $conn = connection();
        $uname = mysqli_real_escape_string($conn,$_POST['uname']);
        $upass = mysqli_real_escape_string($conn,$_POST['password']);
        $query="SELECT * FROM Users WHERE username='$uname'";
        $result = $conn->query($query);
        $row = $result->fetch_assoc();                             
        if($row['Password']==md5($upass) ){
            $_SESSION['user_id'] = $row['user_id'];
            header("Location: ../home/"); 
        }else print("wrong details"); 
    }
?&gt
               		</code>
               </pre>

                </div>
            </div>
        </div>
    </article>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <p class="copyright text-muted">Copyright &copy; Your Website 2014</p>
                </div>
            </div>
        </div>
    </footer>

   <!-- jQuery -->
    <script src="../../js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../../js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../../js/clean-blog.min.js"></script>
    <script src="js/functions.js"></script>
    <script src="../../js/rainbow-custom.min.js"></script>
    <script src="../../js/lan/php.js"></script>
    <script src="../../js/lan/html.js"></script>
     <script>
      
    </script>

</body>

</html>
