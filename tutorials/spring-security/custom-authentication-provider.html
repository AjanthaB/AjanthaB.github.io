<!DOCTYPE html>
<html lang="en" xmlns:c="http://www.w3.org/1999/XSL/Transform">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description"
          content="Spring Security 4.0.3 Spring Configuration with annotation and Basic Authentication and login/logout with custom login form">
    <meta name="Ajantha Bnadara" content="Ajantha Bandara elvinlabs.com">

    <title>Spring Security</title>

    <!-- Bootstrap Core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../css/clean-blog.min.css" rel="stylesheet">
    <link href="../css/clean-blog.css" rel="stylesheet">
    <link href="../css/themes/monokai.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"
          type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet'
          type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
          rel='stylesheet' type='text/css'>

    <!-- Favicons -->
    <link rel="shortcut icon" href="../../favicon.png">

</head>
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../index.html">AjanthaB</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="../">Home</a>
                </li>
                <li>
                    <a href="http://ajantha.elvinlabs.com/">About</a>
                </li>
                <li>
                    <a href="helloWorld.html">Hello Wold Example</a>
                </li>

            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="intro-header" style="background-image: url('../img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1 style="color:#fff;text-align:center;margin-top:-50px;">Spring Security 4.0.3 Tutorial
                    </h1>

                    <span class="meta" style="color:#fff;text-align:center;">Posted by <a href="#">AjanthaB</a> on Dec 31, 2015</span>
                </div>
            </div>
        </div>
    </div>
</header>


<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <div class="col-lg-2 col-md-2">
                <ul class="left-nav">

                    <h3>Other Topics</h3>
                    <li>
                        <a href="index.html">Overview</a>
                    </li>
                    <li>
                        <a href="configuration.html">Configurations</a>
                    </li>
                    <li>
                        <a href="helloWorld.html">Hello Wold Example</a>
                    </li>
                    <li>
                        <a href="custom-login-page.html">custom login page</a>
                    </li>
                    <li>
                        <a href="security-rest-service.html">security RESTful Service</a>
                    </li>
                    <li>
                        <a href="custom-authentication-provider.html">security custom authentication provider</a>
                    </li>

                </ul>
            </div>


            <div class="col-lg-10  col-md-10 ">

                <h2 class="text-info">Spring Security Custom Authentication provider With MongoDB</h2>
                <p>This tutorial is base on spring annotation and maven build tool, latest spring
                    security, spring data-mongodb and latest spring mvc framework and MongoDB</p>

                <p>Technologies Stack</p>
                <ol>
                    <li>Spring mvc 4.2.4.RELEASE</li>
                    <li>Spring Security 4.0.3.RELEASE</li>
                    <li>Intellij IDEA 14</li>
                    <li>JDK 1.8</li>
                    <li>Apache Maven 3.3.9</li>
                    <li>Tomcat 8</li>
                </ol>


                <h3>Project Structure </h3>
                <img src="img/custom-authentication-provider-structure.png" alt="spring security custom login page">

                <h3>Spring Security Dependencies</h3>
                <p class="text-info">pom.xml</p>
                <pre>
                    <code data-language="javascript">
    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <spring.security.version>4.0.3.RELEASE</spring.security.version>
        <spring.mvc.version>4.2.4.RELEASE</spring.mvc.version>
        <jdk.version>1.8</jdk.version>
    </properties>

    <dependencies>

        <!-- Spring Core-->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>${spring.mvc.version}</version>
        </dependency>

        <!--  Spring Web-->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-web</artifactId>
            <version>${spring.mvc.version}</version>
        </dependency>

        <!-- Spring Webmvc -->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
            <version>${spring.mvc.version}</version>
        </dependency>

        <!-- Spring Security Core -->
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-core</artifactId>
            <version>${spring.security.version}</version>
        </dependency>

        <!-- Spring Security Web -->
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-web</artifactId>
            <version>${spring.security.version}</version>
        </dependency>

        <!-- Spring Security Config -->
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-config</artifactId>
            <version>${spring.security.version}</version>
        </dependency>

        <!-- Spring data mongodb -->
        <dependency>
            <groupId>org.springframework.data</groupId>
            <artifactId>spring-data-mongodb</artifactId>
            <version>1.8.1.RELEASE</version>
        </dependency>

        <!-- JSP Tag Library -->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>jstl</artifactId>
            <version>1.2</version>
        </dependency>

        <!-- Jackson Databind -->
        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-databind</artifactId>
            <version>2.6.4</version>
        </dependency>

        <!-- Spring Security TagLib-->
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-taglibs</artifactId>
            <version>${spring.security.version}</version>
        </dependency>
    </dependencies>
                    </code>
                </pre>


                <h2>Spring Application </h2>
                <p>In this controller </p>
                <ol>
                    <li>If URL = <b>/admin</b>  controller will return admin.jsp page</li>
                    <li>If URL = <b>/dba</b>  controller will return admin.jsp page</li>
                    <li>If URL = <b>/welcome</b>  controller will return hello.jsp page</li>
                </ol>
                <p>To get admin.jsp page user have to login to system.</p>

                <p class="text-info"><b>UserController.java</b></p>
                <pre>
                    <code data-language="javascript">
    package com.ajantha.controller;

    import org.slf4j.Logger;
    import org.slf4j.LoggerFactory;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.data.mongodb.core.MongoTemplate;
    import org.springframework.stereotype.Controller;
    import org.springframework.web.bind.annotation.RequestMapping;
    import org.springframework.web.bind.annotation.RequestMethod;
    import org.springframework.web.bind.annotation.RequestParam;
    import org.springframework.web.servlet.ModelAndView;


    /**
    * Created by ajantha on 12/20/15.
    */
    @Controller
    public class UserController {

        private static final Logger LOGGER =
        LoggerFactory.getLogger(UserController.class);

        @Autowired
        private MongoTemplate mongoTemplate;

        @RequestMapping(value = {"/login"}, method = RequestMethod.GET)
            public ModelAndView loginPage(@RequestParam(value = "error",required = false)String error,
            @RequestParam(value = "logout",required = false)String logout ) {
            ModelAndView model = new ModelAndView();
            if (error != null) {
            model.addObject("error", "Invalid Credentials provided.");
            }
            if (logout != null) {
            model.addObject("message", "Logged out successfully.");
            }
            model.setViewName("login");

            return model;
        }

        @RequestMapping(value = "/admin**", method = RequestMethod.GET)
            public ModelAndView adminPage() {
            ModelAndView model = new ModelAndView();
            model.addObject("title", "Spring Security Hello World");
            model.addObject("message", "This is protected page - Admin Page!");
            model.setViewName("admin");

            return model;

        }

        @RequestMapping(value = "/dba**", method = RequestMethod.GET)
            public ModelAndView dbaPage() {
            ModelAndView model = new ModelAndView();
            model.addObject("title", "Spring Security Hello World");
            model.addObject("message", "This is protected page - Database Page!");
            model.setViewName("admin");

            return model;

        }


    }

                    </code>
                </pre>

                <p>When request come, first it going through the security filters. If someOne don't have access
                    to any link give and error page. Let's think when come request <b>/welcome</b> it going through the security filter
                    and create ViewAndModel by the name of admin and show it. How is that happen? viewResolver() method in AppConfig.java(bellow) class
                    is add prefix and suffix into our viewAndModel. True path of our hello.jsp page is <b>/WEB-INF/pages/hello.jsp</b>. It
                    will automatically resolved by the resolver method.</p>


                <p>We are gonna create a POJO class for Application user with Role. </p>
                <p class="text-info"><b>ApplicationUser.java</b></p>
                <pre>
                    <code data-language="javascript">
package com.ajantha.model;


import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.mapping.Document;
import org.springframework.security.core.userdetails.UserDetails;

import java.util.List;

/**
* Created by ajantha on 1/1/16.
*/
@Document(collection = "applicationuser")
public  class ApplicationUser implements UserDetails {

    @Id
    private String  userId;
    private String userName;
    private String password;
    private String firstName;
    private String lastName;
    private String email;
    private List<Role> authorities;
    private boolean accountNonExpired = true;
    private boolean accountNonLocked = true;
    private boolean credentialsNonExpired = true;
    private boolean enabled = true;

    public ApplicationUser() {
    }

    public String getTestUserId() {
        return testUserId;
    }

    public void setTestUserId(String testUserId) {
        this.testUserId = testUserId;
    }

    @Override
    public String getUsername() {
        return userName;
    }

    public void setUsername(String userName) {
        this.userName = userName;
    }


    @Override
    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    @Override
    public List<Role> getAuthorities() {
        return authorities;
    }

    public void setAuthorities(List<Role> authorities) {
        this.authorities = authorities;
    }

    @Override
    public boolean isAccountNonExpired() {
        return accountNonExpired;
    }

    public void setAccountNonExpired(boolean accountNonExpired) {
        this.accountNonExpired = accountNonExpired;
    }

    @Override
    public boolean isAccountNonLocked() {
        return accountNonLocked;
    }

    public void setAccountNonLocked(boolean accountNonLocked) {
        this.accountNonLocked = accountNonLocked;
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return credentialsNonExpired;
    }

    public void setCredentialsNonExpired(boolean credentialsNonExpired) {
        this.credentialsNonExpired = credentialsNonExpired;
    }

    @Override
    public boolean isEnabled() {
        return enabled;
    }

    public void setEnabled(boolean enabled) {
        this.enabled = enabled;
    }
}

                    </code>
                </pre>




                <p>In here we have to override the methods in UserDetails interface.</p>

                <p class="text-info"><b>Role.java</b></p>
                <pre>
                    <code data-language="javascript">
    package com.ajantha.model;

    import org.springframework.security.core.GrantedAuthority;

    /**
    * Created by ajantha on 1/2/16.
    */
    public class Role  implements GrantedAuthority {
        private String name;


        public String getName() {
            return name;
        }

        public void setName(String name) {
            this.name = name;
        }

        public String getAuthority() {
            return this.name;
        }
    }
                    </code>
                </pre>


                <p class="text-info">ApplicationUserAuthenticationProvider.java</p>
                <pre>
                    <code data-language="javascript">
    package com.ajantha.service;

    import com.ajantha.model.ApplicationUser;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.security.authentication.AuthenticationProvider;
    import org.springframework.security.authentication.BadCredentialsException;
    import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
    import org.springframework.security.core.Authentication;
    import org.springframework.security.core.AuthenticationException;
    import org.springframework.security.core.GrantedAuthority;
    import org.springframework.stereotype.Component;

    import java.util.Collection;

    /**
    * Created by ajantha on 1/2/16.
    */
    @Component
    public class ApplicationUserAuthenticationProvider implements AuthenticationProvider {

        @Autowired
        private ApplicationUserService applicationUserService;

        @Override
        public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        String username = authentication.getName();
        String password = (String) authentication.getCredentials();

        ApplicationUser user = applicationUserService.loadUserByUsername(username);

        if (user == null || !user.getUsername().equalsIgnoreCase(username)) {
            throw new BadCredentialsException("Username not found.");
        }

        if (!password.equals(user.getPassword())) {
            throw new BadCredentialsException("Wrong password.");
        }

        Collection<? extends GrantedAuthority> authorities = user.getAuthorities();

            return new UsernamePasswordAuthenticationToken(user, password, authorities);
        }

        @Override
        public boolean supports(Class<?> arg0) {
            return true;
        }

    }

                    </code>
                </pre>


                <p class="text-info">ApplicationUserService.java</p>
                <pre>
                    <code data-language="javascript">
    package com.ajantha.service;

    import com.ajantha.model.ApplicationUser;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.security.core.userdetails.UserDetailsService;
    import org.springframework.security.core.userdetails.UsernameNotFoundException;
    import org.springframework.stereotype.Service;

    /**
    * Created by ajantha on 1/1/16.
    */
    @Service
    public class ApplicationUserService implements UserDetailsService {

        @Autowired
        private ApplicationUserServiceImpl testUserService;

        public ApplicationUser loadUserByUsername(String username) throws UsernameNotFoundException {
            return testUserService.loadUserByUsername(username);
        }

    }

                    </code>
                </pre>


                <p class="text-info">ApplicationUserServiceImpl.java</p>
                <pre>
                    <code data-language="javascript">
    package com.ajantha.service;

    import com.ajantha.base.Base;
    import com.ajantha.model.ApplicationUser;
    import org.slf4j.Logger;
    import org.slf4j.LoggerFactory;
    import org.springframework.data.mongodb.core.query.Criteria;
    import org.springframework.data.mongodb.core.query.Query;
    import org.springframework.stereotype.Repository;


    /**
    * Created by ajantha on 1/1/16.
    */

    @Repository
    public class ApplicationUserServiceImpl extends Base {

        private static final Logger LOGGER =
        LoggerFactory.getLogger(ApplicationUserServiceImpl.class);

        public ApplicationUser loadUserByUsername(final String username) {


            LOGGER.debug("userName================"+username);
            Query query = new Query();
            query.addCriteria(Criteria.where("userName").is(username));
            ApplicationUser applicationUser = getMongoTemplate().findOne(query,ApplicationUser.class);
            LOGGER.debug("userName================"+ applicationUser.getPassword());

            return applicationUser;
        }

    }

                    </code>
                </pre>


                <p>But Keep Remember to add user to your database. It can do that using this class. Run this first and
                to add</p>

                <pre>
                    <code data-language="javascript">
    package com.ajantha.controller;

    import com.ajantha.config.MongoConfig;
    import com.ajantha.model.ApplicationUser;
    import com.ajantha.model.Role;
    import org.springframework.context.ApplicationContext;
    import org.springframework.context.annotation.AnnotationConfigApplicationContext;
    import org.springframework.data.mongodb.core.MongoTemplate;

    import java.util.ArrayList;
    import java.util.List;

    /**
    * Created by ajantha on 1/3/16.
    */
    public class test {
        public static void main(String[] args) {

        ApplicationContext applicationContext = new AnnotationConfigApplicationContext(MongoConfig.class);
        MongoTemplate mongoTemplate = (MongoTemplate) applicationContext.getBean("mongoTemplate");

        ApplicationUser user = new ApplicationUser();
        user.setFirstName("Ajantha");
        user.setLastName("Bandara");
        user.setUsername("admin");
        user.setPassword("123456");
        Role role= new Role();
        role.setName("ROLE_ADMIN");
        List<Role> roles = new ArrayList<>();
        roles.add(role);
        user.setAuthorities(roles);

        mongoTemplate.insert(user);

        }
    }

                    </code>
                </pre>

                <p class="text-info">Base.java</p>
                <pre>
                    <code data-language="javascript">
    package com.ajantha.base;

    import com.ajantha.config.MongoConfig;
    import org.springframework.context.ApplicationContext;
    import org.springframework.context.annotation.AnnotationConfigApplicationContext;
    import org.springframework.data.mongodb.core.MongoOperations;
    import org.springframework.data.mongodb.core.MongoTemplate;

    /**
    * Created by ajantha on 1/2/16.
    */
    public class Base {

        public  ApplicationContext applicationContext;
        public  MongoTemplate mongoTemplate ;
        public  MongoOperations mongoOperations ;

        public  MongoTemplate getMongoTemplate(){
            applicationContext = new AnnotationConfigApplicationContext(MongoConfig.class);
            mongoTemplate = (MongoTemplate) applicationContext.getBean("mongoTemplate");

            return mongoTemplate;
        }


    }

                    </code>
                </pre>

                <h2>JSP pagess</h2>
                <p class="text-info">login.jsp</p>
                <pre>
                    <code data-language="javascript">
    <%@ page contentType="text/html;charset=UTF-8" language="java" %>
    <%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
    <%@page session="true"%>
    &lthtml&gt
    &lthead&gt
    <title></title>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <link rel='stylesheet' href='webjars/bootstrap/3.3.6/css/bootstrap.min.css'>
    <link rel="stylesheet" href="resources/css/loginpage.css">
    &lt/head&gt
    &ltbody&gt
    <div class="wrapper">
        <form class="form-signin" name='loginForm'
              action="<c:url value='login'/>" method='POST'>
            <h2 class="form-signin-heading">Please login</h2>
            <c:if test="${not empty error}">
                <div class="text-danger">${error}</div>
            </c:if>
            <c:if test="${not empty message}">
                <div class="text-success">${message}</div>
            </c:if>

            <input type="text" class="form-control" name="username" placeholder="Email Address" required/>
            <input type="password" class="form-control" name="password" placeholder="Password" require/>
            <label class="checkbox">
                <input type="checkbox" value="remember-me" id="rememberMe" name="rememberMe"> Remember me
            </label>
            <button class="btn btn-lg btn-primary btn-block" type="submit">Login</button>

            <input type="hidden" name="${_csrf.parameterName}"
                   value="${_csrf.token}" />
        </form>
    </div>
    &lt/body&gt
    &lthtml&gt

                    </code>
                </pre>
                <p class="text-info">admin.jsp</p>
                <pre>
                    <code data-language="javascript">
    <%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
    <%@page session="false"%>
    &lthtml&gt
    &ltbody&gt
    <h1>Title : ${title}</h1>
    <h1>Message : ${message}</h1>
        <c:if test="${pageContext.request.userPrincipal.name != null}">
            <h2>Welcome : ${pageContext.request.userPrincipal.name}
                | <a href="<c:url value="logout" />" > Logout </a>
            </h2>
        </c:if>
    &lt/body&gt
    &lt/html&gt
                    </code>
                </pre>
                <p>We can access the object send by the controller using jstl tags as above</p>

                <p class="text-info"> hello.jsp</p>
                <pre>
                    <code data-language="javascript">
    <%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
    <%@page session="false"%>
    &lthtml&gt
    &ltbody&gt
    <h1>Title : ${title}</h1>
    <h1>Message : ${message}</h1>
    <c:if test="${pageContext.request.userPrincipal.name != null}">
        <h2>Welcome : ${pageContext.request.userPrincipal.name}
            | <a href="<c:url value="logout" />" > Logout </a>
        </h2>
    </c:if>
    &lt/body&gt
    &lt/html&gt
                    </code>
                </pre>
                <p>We can get the logged users name as userPricipal.name </p>

                <p>To use Spring security, we need <b class="text-info">spring-security-web</b> and <b class="text-info">spring-security-config</b></p>



                <h3>Spring MongoDB Configuration</h3>
                <p class="text-info"><b>MongoConfig.java</b></p>
                <p>Before application run Start the mongoDb server. </p>
                <pre>
                    <code data-language="javascript">
    package com.ajantha.config;

    import com.mongodb.MongoClient;
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;
    import org.springframework.data.mongodb.config.AbstractMongoConfiguration;
    import org.springframework.data.mongodb.core.MongoTemplate;

    /**
    * Created by ajantha on 1/1/16.
    */

    @Configuration
    public class MongoConfig extends AbstractMongoConfiguration {

        @Override
        public String getDatabaseName(){
            // i am using my database name as "testdb"
            return "testdb";
        }

        @Override
        public MongoClient mongo(){
            return new MongoClient("127.0.0.1");
        }

        @Override
        @Bean
        public MongoTemplate mongoTemplate() throws Exception {
            return new MongoTemplate(mongo(), getDatabaseName());
        }
    }

                    </code>
                </pre>

                <h3>Spring Security Configurations</h3>
                <p>Create a Spring Security configuration java base file, and annotated with <b>@EnableWebSecurity</b></p>
                <p>In this class defined few Role according to access capability of the users.</p>
                <p class="text-info"><b>SecurityConfig.java</b></p>
                <pre>
                 <code data-language="javascript">
     package com.ajantha.config;

     import com.ajantha.service.ApplicationUserAuthenticationProvider;
     import org.springframework.beans.factory.annotation.Autowired;
     import org.springframework.context.annotation.Configuration;
     import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
     import org.springframework.security.config.annotation.web.builders.HttpSecurity;
     import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
     import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
     import org.springframework.security.web.util.matcher.AntPathRequestMatcher;

     /**
     * Created by ajantha on 12/20/15.
     */

     @Configuration
     @EnableWebSecurity
     public class SecurityConfig extends WebSecurityConfigurerAdapter {

         @Autowired
         private ApplicationUserAuthenticationProvider authenticationProvider;

         @Autowired
         public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
            auth.authenticationProvider(authenticationProvider);
         }

         @Override
         protected void configure( HttpSecurity http) throws Exception {

             http
             .authorizeRequests()
             .antMatchers("/user/**").access("hasRole('ROLE_USER')")
             .antMatchers("/admin/**").access("hasRole('ROLE_ADMIN')")
             .antMatchers("/rest/**").access("hasRole('ROLE_ADMIN')")
             .and()
             .formLogin()
             .loginPage("/login")
             .defaultSuccessUrl("/welcome")
             .failureUrl("/login?error")
             .and()
             .logout()
             .logoutSuccessUrl("/login?logout")
             .and()
             .csrf();

             AntPathRequestMatcher pathRequestMatcher = new
             AntPathRequestMatcher("/logout");
            http.logout().logoutRequestMatcher(pathRequestMatcher);

     }


     }



                 </code>
                </pre>
                <p><b>Configure()</b> method is used to configure the resources availability of each user
                    called Authorization. When we use <b>"admin/**"</b>, all requested URLs begin with "/admin"
                    only can access with Role <b>ADMIN</b>.</p>


                <p>Next create a class extends <b>AbstractSecurityWebApplicationInitializer</b>,
                    it will load the springSecurityFilterChain automatically.</p>

                <p class="text-info"><b>SpringSecurityInitializer.java</b></p>
                <pre>
                    <code data-language="javascript">
    package com.ajantha.config.core;
    import org.springframework.security.web.context.AbstractSecurityWebApplicationInitializer;

    public class SpringSecurityInitializer extends AbstractSecurityWebApplicationInitializer {
    // we only want to initialize this
    }
                    </code>
                </pre>

                <h3>Spring MVC Configuration</h3>
                <p>A Config class, define the viewâ€™s technology and imports above <b>SecurityConfig.java</b></p>
                <p>Spring detect this configuration class using <b>@Configuration</b> annotation and scan package
                    "com.ajantha.web.*" for Beans. And we also import security configuration class using <b>@Import</b> annotation.</p>
                <p class="text-info"><b>AppConfig.java</b></p>
                <pre>
                    <code data-language="javascript">
    package com.ajantha.config;

    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.ComponentScan;
    import org.springframework.context.annotation.Configuration;
    import org.springframework.context.annotation.Import;
    import org.springframework.web.servlet.config.annotation.EnableWebMvc;
    import org.springframework.web.servlet.view.InternalResourceViewResolver;
    import org.springframework.web.servlet.view.JstlView;

    @EnableWebMvc
    @Configuration
    @ComponentScan({ "com.ajantha.web.*" })
    @Import({ SecurityConfig.class })
    public class AppConfig {

        @Bean
        public InternalResourceViewResolver viewResolver() {
            InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();
            viewResolver.setViewClass(JstlView.class);
            viewResolver.setPrefix("/WEB-INF/pages/");
            viewResolver.setSuffix(".jsp");

            return viewResolver;
        }

        @Override
        public void addResourceHandlers(ResourceHandlerRegistry registry) {
            registry.addResourceHandler("webjars/**", "resources/**")
            .addResourceLocations("classpath:/META-INF/resources/webjars/")
            .addResourceLocations("resources/");
        }

    }
                    </code>
                </pre>

                <p>In this class <b>addResourceHandlers()</b> is used to handle the static resources like css,js,
                    and images. Also if you want to add <b>webjars</b> to your project add above <b>addResourceHandlers()</b> method.</p>


                <h3>Create a Initializer class, to load everything.</h3>
                <p class="text-info"><b>SpringMvcInitializer.java</b></p>
                <pre>
                    <code data-language="javascript">
    package com.ajantha.config.core;

    import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;
    import com.ajantha.config.AppConfig;

        public class SpringMvcInitializer
        extends AbstractAnnotationConfigDispatcherServletInitializer {

        @Override
        protected Class<&#63>[] getRootConfigClasses() {
            return new Class[] { AppConfig.class };
        }

        @Override
        protected Class<&#63>[] getServletConfigClasses() {
            return null;
        }

        @Override
        protected String[] getServletMappings() {
            return new String[] { "/" };
        }

    }
                    </code>
                </pre>
                <h4 class="text-info">Note
                    In Servlet 4.x container environment + Spring container will
                    detect and loads the Initializer classes automatically.
                </h4>

                <h2 class="text-info">Demo</h2>
                <p>127.0.0.1:8080/Spring-Security-HelloWorld/</p>
                <img src="img/hello.png" alt="result for /welcome url">
                <p>127.0.0.1:8080/Spring-Security-HelloWorld/login</p>
                <img src="img/custom-login-page.png" alt="result for /login url">

                <p>127.0.0.1:8080/Spring-Security-HelloWorld/admin</p>
                <img src="img/admin-page.png" alt="result for /admin url">

                <p>127.0.0.1:8080/Spring-Security-HelloWorld/admin</p>
                <img src="img/security-rest-logout.png" alt="result for /admin url">

                <h4>Download the Zip file from here <a href="zip/spring-custom-Authentication-mongodb.zip"><i class="fa fa-download fa-2x"></i></a></h4>
            </div>
        </div>
    </div>
</article>

<hr>

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                </ul>
                <p class="copyright text-muted">Copyright &copy; Your Website 2014</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="../js/jquery.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="../js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="../js/clean-blog.min.js"></script>
<script src="../js/rainbow-custom.min.js"></script>
<script src="../js/lan/java.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/lan/javascript.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/lan/html.js" type="text/javascript" charset="utf-8"></script>

<script>

</script>


</body>
</html>